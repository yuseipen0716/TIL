## Redux Style Guide memo

### Introduction

これはReduxのコードを書くための公式のスタイルガイドです。Reduxのアプリ開発において、推奨されるパターンやベストプラクティス、提案されているアプローチ等を載せている。

Reduxのcoreも多くのReduxドキュメントも、この方法でなければならないと、唯一の答えを提示しているわけではない。Reduxには様々な使い方があるので、ただ一つの「正解」というのはない。

ただ、時間の経過や経験によって、これらのトピックについて、ほかの方法よりはいいよねっていういくつかのアプローチが見えてきた。加えて、多くの開発者から、
よい方法を模索する負担軽減のために、公式のドキュメントを残してほしいという希望もあった。

そこで我々は、無数のエラーの解決、bikeshedding(なにこれ)、アンチパターンの解決のために推奨される事項をまとめた。

好みの違いや、プロジェクトによって求められる要件が違うことなどにより、すべてのパターンにはまるドキュメントを作ることができないことは心得ている。
これらの推奨事項について、ぜひ胸を張って使用してほしいが、自身の状況等に応じて、臨機応変に対応してくださいませ。

最後に、Vueのスタイルガイドにインスピレーションを受けたよ。ありがとう。

### 推奨度分類のルール

優先度に応じたカテゴリー分けをしている。Priority AからPriority Cまである。

- Priority A: Essential
  - これらのルールはエラーを防ぐことに役立つため、ずべこべ言わずに覚えて、守ってください。
  - このルールに当てはまらないこともあるかもしれませんが、大変稀なことなので、基本的にルールから外れるのは、JavaScriptとReduxに精通した人だけにしてください。
- Priority B: Strongly Recommended
  - こちらのルールはほとんどのプロジェクトで、可読性向上と開発体験の改善に寄与することがわかっている。
  - 守らなくても動くけど、正当な理由を述べてからにしろ。
  - 合理的に可能な限りは、とにかくこのルールを守りなさい。
- Priority C: Recommended
  - 同じように優れた複数の選択肢が存在する場合、一貫性を確保するために任意の選択をすることができる。
  - これらのルールでは許容可能な選択肢を記述し、デフォルトの選択肢を提示します。
  - つまりきちんとした、合理的な理由があれば、自由な選択をしてもよいということです。きちんとした理由があれば、ね。

### Priority A Rules: Eddential

#### Do Not Mutate State

stateの破壊的な変異はコンポーネントの再レンダリングができなくなるなど、様々なバグの一般的な原因となる。またRedux DevToolsのtime-trace debuggingも壊れちゃうかもしれない。

Reducerの内部でも、ほかのアプリケーションコード内でも**stateを実際に変更してしまうのは避けるべき。**

`redux-immutable-state-invariant`のようなツールや`Immer`を使うことで、意図しないstateの破壊的な変更を避けることができる

(注) 変更したい対象のコピーを変更するのはかまいません。むしろ、非破壊的な更新処理を行う上では一般的な方法。また、Immerライブラリを使用すれば、
破壊的な更新ロジックを書いてしまっても安全に更新することができる。

#### Redux Must Not Have Side Effects

Reducer関数は引数として受け取るstateやactionに対してのみ依存性を持つべきで、また、Reducer関数はそれらの値をもとに新しいstateを返す処理のみ行うべきである。

**Reducer関数はAJAXやtimeouts、promiseなどの非同期処理の実行、`Date.now()`,`Math.random()`などの乱数生成、外部のReducerを引数として指定すること、またそのReducer関数の
scope外のコードを実行するべきではない。**

(注)チーム内で同じルールに従うのであれば、外部のライブラリや、Reducer外で定義したコードを実行してもよい。

#### Do Not Put Non-Serializable Values in State or Actions

**PromiseやSymbols, Maps/Sets, 関数, クラスのインスタンスなどのNon-Serializable value(順がつけられない値?)はReduxストアにstateやdispatchアクションで置くのは避ける。**

これにより、ReduxDevtoolsは期待通り動作するだろうし、UIの更新も期待通りいくだろう。

#### Only One Redux Store Per App

**一般的なReduxのアプリケーションはアプリケーション全体でただ一つだけのstoreをもつべきである。** それはたいてい、`store.js`というようなファイルに分けておく。

理想的には、アプリケーションロジックをstoreが直接importしないようにする.

それはReact-Reduxの<Provider>コンポーネントを経て、Reactのコンポーネントツリーに渡されるべきで、また、間接的にthunkのようなミドルウェアに参照させるべき。
  
ごくごくまれに、ロジックを直接つっこまないといけない場面があるかもしれないが、それは最終手段です。
  

