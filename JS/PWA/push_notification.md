## push通知について

### プッシュ通知とは

サーバ側からクライアントに対して情報を通知すること。

Webページを閲覧中ではないユーザーに対して何か通知をするのはService Worker以前のWeb技術では不可能だったが、Service Workerのおかげで実現可能になった。

### プッシュ通知に関わる要素

- ブラウザ
- Webサーバ（アプリケーションサービス）
- プッシュサービス

### プッシュ通知の流れ

プッシュ通知は大きく分けて、「準備」と「利用」の2段階がある。

#### 準備

1. アプリケーションサービス用の鍵ペアを作成。秘密鍵はアプリケーションサービスが保持
    1. `$ npm install web-push -g`
    1. `$ web-push generate-vapid-keys`
3. ユーザーが書いたJavaScriptからブラウザに公開が儀を渡し、プッシュ通知に必要な情報を要求
4. ブラウザはプッシュサービスに公開鍵を渡し、プッシュ通知に必要な情報を取得
5. ブラウザはプッシュサービスの監視を開始
6. ブラウザ→JavaScript プッシュ通知に必要な情報を送信
7. JavaScriptはアプリケーションサービスに対してプッシュ通知に必要な情報（エンドポイントなど）を送信

#### プッシュ通知の送受信

1. JavaScriptはブラウザにpushイベントハンドラを登録
2. アプリケーションサービス→必要な情報を使用して、プッシュサービスに通知内容を登録
3. プッシュサービス→アプリケーションサービスを認証
4. 認証成功→ブラウザに通知内容を送信
5. ブラウザ→JavaScriptのコールバックを実行




> 参考: O'REILLY 　ハンズオン JavaScript

