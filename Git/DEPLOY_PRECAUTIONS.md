## デプロイ時に注意すべきことと、対策

### migrationファイル、schemaファイルの変更を行った際のデプロイ

既存のテーブルに新しいカラムを追加した際などには、新しくmigrationファイルが生成されると思う。また、db/schema.rbなどのファイルにも変更が加わる。

それを本番環境に、ほかのコードと一緒に、えいや！って反映させると、どうやら大変なことになるらしい。

具体的には、本番環境にデプロイした時点ではmigrationは自動的にされないため、変更されたテーブルの情報が反映されず、新しく追加したカラムを表示しているコードなどがうまく動かず、
エラーが出てしまい、サイトがおちると...

#### 解決策?

まだ調べ途中ではあるが、masterブランチからmigrationをするためのブランチを切り、そちらに変更があったmigrationファイルやdb/schema等のdb関連のファイルのみを反映させ、migrationする。

`git cherry-pick <mergeしたいコミットのコミットID>`を使えば、特定のコミットのみ抜き出してmergeすることができるみたい。

> cherry-pickについて: [【Git】cherry-pickで解決🍒](https://qiita.com/okmtz/items/62aa5a25f75b1754a861)

↑ は当時の案件のデプロイ環境が特殊だっという可能性が高い。

### デプロイの際にみるべきところ
#### DBのカラム等の変更があるかどうか
DB等のカラム等の変更がある場合、そのMerge CommitをRevertする際にDBの方もrollbackしないと不整合が生じる。

また、カラム追加を行う場合でdefault値を入れない場合は、本番データのメンテが必要になるので、注意。

